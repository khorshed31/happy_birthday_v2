<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>🎉 Surprise Birthday!</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&family=Great+Vibes&family=Orbitron:wght@600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  :root{
    --wall:#131a2b; --floor:#0a0e18;
    --accent:#ff4d8d; --gold:#f9c642; --neon:#ffd3e6; --light:#ffe8a3;
    --glass-bg: rgba(255,255,255,.06); --glass-brd: rgba(255,255,255,.18);
    --text-grad: linear-gradient(90deg, #ff66a3, #ffd43b, #5eead4, #60a5fa, #ff66a3);
  }

  *, *::before, *::after{ box-sizing:border-box; }
  html, body { height:100%; }
  body{
    margin:0; color:#fff; overflow-x:hidden;
    font-family:'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background: linear-gradient(180deg, var(--wall) 0 55%, var(--floor) 55% 100%);
    -webkit-font-smoothing:antialiased;
    -webkit-tap-highlight-color: transparent;
    padding-bottom: env(safe-area-inset-bottom, 0);
  }
  .hidden{ display:none !important; }

  /* Vignette + floor seam */
  body:before{
    content:""; position:fixed; inset:0; z-index:0; pointer-events:none;
    background: radial-gradient(1200px 600px at 50% -10%, rgba(255,255,255,.06), rgba(0,0,0,.6) 60%, rgba(0,0,0,.85) 100%);
    mix-blend-mode:screen; opacity:.7;
  }
  body:after{
    content:""; position:fixed; left:0; right:0; top:55%; height:4px; z-index:0;
    background:linear-gradient(90deg, rgba(255,255,255,.18), rgba(255,255,255,.04), rgba(255,255,255,.18));
  }

  .scene{
    position:relative; min-height:100vh;
    display:flex; align-items:center; justify-content:center; text-align:center;
    padding:clamp(4rem, 6vw, 10rem) 1rem clamp(3.5rem, 5vw, 6rem);
    z-index:1;
  }

  /* DOORS */
  .doors{ position:fixed; inset:0; z-index:80; pointer-events:auto; }
  body.open .doors{ pointer-events:none; }
  .door{
    position:absolute; top:0; width:50%; height:100%;
    background:
      linear-gradient(135deg, rgba(0,0,0,.25), rgba(255,255,255,.05)),
      repeating-linear-gradient(180deg, #5b3a2a 0 10px, #4b2f24 10px 20px),
      radial-gradient(100% 100% at 50% 0%, #6e4734 0%, #2e1913 70%);
    box-shadow:inset 0 0 80px rgba(0,0,0,.65), 0 20px 60px rgba(0,0,0,.35);
    transition:transform 1.1s ease-in-out; will-change: transform;
  }
  .door.left{ left:0; border-right:4px solid #3b2017; }
  .door.right{ right:0; border-left:4px solid #3b2017; }
  body.open .door.left{ transform:translateX(-100%); }
  body.open .door.right{ transform:translateX(100%); }
  .handle{ position:absolute; top:50%; width:18px; height:18px; border-radius:50%; background:radial-gradient(circle at 35% 35%, #fff6cc, #cda85a 60%, #926c28 100%); box-shadow:0 0 0 3px rgba(0,0,0,.35); }
  .door.left .handle{ right:18px; } .door.right .handle{ left:18px; }

  .door-button{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    width:min(140px, 38vw); height:min(140px, 38vw); min-width:92px; min-height:92px;
    border-radius:999px; cursor:pointer; z-index:85;
    background: radial-gradient(circle at 30% 30%, #fff8cc, #ffb703 55%, #b45309 100%);
    box-shadow:0 0 0 8px rgba(0,0,0,.25), 0 0 30px 6px rgba(255,197,61,.45),
               inset 0 8px 18px rgba(255,255,255,.45), inset 0 -8px 18px rgba(0,0,0,.35);
    display:flex; align-items:center; justify-content:center; transition: transform .15s ease, box-shadow .2s ease;
    touch-action:manipulation;
  }
  .door-button:active{ transform:translate(-50%,-50%) scale(0.98); }
  .door-button span{ font-weight:800; letter-spacing:.5px; text-transform:uppercase; line-height:1.1; font-size:clamp(12px, 3.5vw, 14px); color:#442c00; text-shadow:0 1px 0 rgba(255,255,255,.5); width:80%; text-align:center; }
  .door-label{ position:absolute; left:50%; top:calc(50% + min(95px, 26vw)); transform:translateX(-50%); font-size:clamp(12px, 3.2vw, 14px); opacity:.9; letter-spacing:.3px; padding:0 .5rem; text-align:center; }

  .dark-overlay{ position:fixed; inset:0; background:radial-gradient(circle at 50% -20%, rgba(255,255,255,0.06), rgba(0,0,0,0.92) 55%); transition:opacity .7s ease; z-index:1; pointer-events:none; }
  body.lights-on .dark-overlay{ opacity:0; }

  .bunting{ position:absolute; top:0; left:0; right:0; height:64px; opacity:0; transition:opacity 1s ease .2s; z-index:3; }
  .string-lights{ position:absolute; top:4px; left:0; right:0; height:82px; pointer-events:none; opacity:0; transition:opacity .9s ease .2s; z-index:5; }
  body.lights-on .bunting, body.lights-on .string-lights{ opacity:1; }

  /* FX layers */
  .balloons, .confetti, .sparkles { position:fixed; inset:0; pointer-events:none; }
  .balloons{ overflow:hidden; opacity:0; transition:opacity 1s ease .3s; z-index:1; }
  body.lights-on .balloons{ opacity:1; }
  .balloon-wrap{ position:absolute; bottom:-25vh; width:76px; height:118px; filter:drop-shadow(0 10px 14px rgba(0,0,0,.35)); }
  .balloon-svg{ width:76px; height:100px; opacity:.9; }
  .balloon-string{ position:absolute; top:80px; left:38px; width:2px; height:100px; background:linear-gradient(#eee,#bbb); opacity:.85; }
  @keyframes floatUp{ 0%{ transform:translateY(0) translateX(0) rotate(0deg);} 100%{ transform:translateY(-135vh) translateX(var(--drift,0)) rotate(var(--twist,6deg)); } }

  .sparkles{ z-index:2; }
  .sparkles span{ position:absolute; width:4px; height:4px; background:#fff; border-radius:50%; box-shadow:0 0 8px #fff, 0 0 14px var(--light); animation:sparkle 2.6s linear infinite; }
  @keyframes sparkle{ 0%{transform:translateY(0); opacity:0;} 10%{opacity:1;} 100%{transform:translateY(-40vh); opacity:0;} }

  .confetti{ z-index:7; overflow:hidden; }
  .confetti span{ position:absolute; width:10px; height:14px; opacity:0; }
  @keyframes fall{0%{opacity:1; transform:translateY(-100vh) rotate(0);}100%{opacity:1; transform:translateY(110vh) rotate(720deg);} }

  /* Cake */
  .table-surface{
    width:min(820px, 94vw); height:40px; margin: 0 auto; border-radius:14px;
    background: linear-gradient(180deg,#8f5e3e,#6d422a 60%, #5a3521);
    box-shadow: 0 12px 28px rgba(0,0,0,.35), inset 0 2px 0 rgba(255,255,255,.25);
    z-index:0;
  }
  .cake-wrap{ opacity:0; transform:translateY(16px); transition:all .7s ease; z-index:6; }
  body.lights-on .cake-wrap{ opacity:1; transform:none; }
  .cake-svg{ display:block; margin:1.2rem auto 0; width:100%; max-width:560px; height:auto; }
  .candle-hit{ cursor:pointer; touch-action:manipulation; }
  .flame{ opacity:0; filter:drop-shadow(0 0 10px rgba(255,190,70,.85)); transition:opacity .25s ease; }
  .flame.flicker{ animation:flicker .12s infinite alternate ease-in-out; }
  @keyframes flicker{ from{transform:scaleY(1);} to{transform:scaleY(1.12) translateX(1px);} }

  /* Messages */
  .neon{ font-weight:800; letter-spacing:.5px; text-shadow:0 0 6px var(--neon), 0 0 14px var(--neon), 0 0 28px #ff4d8d; }
  .message-card{
    margin:12px auto 18px; padding:14px 16px; max-width:820px;
    background:var(--glass-bg); border:1px solid var(--glass-brd); border-radius:18px;
    backdrop-filter:blur(6px);
    box-shadow:0 10px 32px rgba(0,0,0,.18), inset 0 0 40px rgba(255,255,255,.05);
    position:relative; z-index:5;
  }
  #typeLine{
    font-weight:800; font-size:clamp(1.2rem, 2vw + .9rem, 2rem); line-height:1.3;
    background:var(--text-grad); background-size:300% 300%; -webkit-background-clip:text; background-clip:text; color:transparent;
    animation:hueflow 9s ease-in-out infinite alternate; text-shadow:0 2px 0 rgba(0,0,0,.35);
    word-break:break-word;
  }
  @keyframes hueflow{ 0%{background-position:0% 50%;} 100%{background-position:100% 50%;} }

  /* Gift */
  .gift-stage{ margin-top:12px; position:relative; z-index:6; }
  .gift{
    width:min(220px, 60vw); height:min(175px, 48vw); margin:0 auto; position:relative; cursor:pointer;
    filter: drop-shadow(0 14px 26px rgba(0,0,0,.35));
    transition: transform .15s ease;
    touch-action:manipulation;
  }
  .gift:active{ transform: translateY(1px) scale(.995); }
  .gift .box{
    position:absolute; bottom:0; width:100%; height:calc(100% - 42px); border-radius:16px;
    background: linear-gradient(180deg,#7c3aed 0%, #5b21b6 100%);
    border:1px solid rgba(255,255,255,.15);
    overflow:hidden;
  }
  .gift .lid{
    position:absolute; bottom:calc(100% - 50px); left:50%; transform:translateX(-50%); width:calc(100% + 24px); height:50px; border-radius:16px;
    background: linear-gradient(180deg,#4c1d95 0%, #3b0764 100%);
    border:1px solid rgba(255,255,255,.18);
    box-shadow:0 10px 20px rgba(0,0,0,.35);
    transform-origin:50% 100%;
    transition: transform .55s ease;
  }
  .gift.open .lid{ transform: translate(-50%,-120px) rotate(-10deg); }

  .ribbon-v{
    position:absolute; left:50%; transform:translateX(-50%); width:30px; height:100%; top:0;
    background: linear-gradient(180deg,#ffd43b,#f59e0b); border-radius:12px; box-shadow: inset 0 0 8px rgba(255,255,255,.45);
  }
  .ribbon-h{
    position:absolute; top:32px; left:8px; right:8px; height:26px; border-radius:12px;
    background: linear-gradient(180deg,#ffd43b,#f59e0b); box-shadow: inset 0 0 8px rgba(255,255,255,.45);
  }

  .surprise{ margin-top:12px; position:relative; z-index:6; }
  .emoji-burst{ pointer-events:none; position:absolute; left:50%; bottom:110px; transform:translateX(-50%); }
  .emoji-burst span{
    position:absolute; font-size:22px; opacity:0; animation: pop 1.2s ease forwards;
  }
  @keyframes pop{
    0%{ transform: translate(0,0) scale(.6); opacity:0; }
    10%{ opacity:1; }
    100%{ transform: translate(var(--dx), var(--dy)) scale(1.2); opacity:0; }
  }

  /* Surprise image + card (now in normal flow) */
  .surprise-image{
    display:block; margin:0.5rem auto 12px;width: min(340px, 45vw); max-height:60vh; object-fit:cover;
    border-radius:18px; background: rgb(240 178 178 / 40%);
    border:2px solid transparent;
    border-image: linear-gradient(90deg, #ff66a3, #ffd43b, #5eead4, #60a5fa, #ff66a3) 1;
    box-shadow: 0 14px 30px rgba(0,0,0,.45), 0 0 22px rgba(255,77,141,.25), inset 0 0 30px rgba(255,255,255,.06);
    opacity:0; transform:translateY(12px) scale(.98);
    transition: all .55s cubic-bezier(.2,.8,.2,1);
  }

  .joker-card{
    position:relative; left:50%; transform:translateX(-50%) translateY(10px) scale(.98);
    opacity:0; width:min(92vw, 560px); margin:0 auto 8px;
    padding:18px 16px; border-radius:18px; text-align:center;
    background: radial-gradient(120% 120% at 0% 0%, rgba(255,255,255,.18), rgba(255,255,255,.06) 60%);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    border:2px solid transparent;
    border-image: linear-gradient(90deg, #ff66a3, #ffd43b, #5eead4, #60a5fa, #ff66a3) 1;
    animation: neonFlow 8s linear infinite;
    box-shadow: 0 10px 28px rgba(0,0,0,.5), 0 0 22px rgba(255,77,141,.35), inset 0 0 30px rgba(255,255,255,.10);
    transition: all .55s cubic-bezier(.2,.8,.2,1);
  }

  /* Reveal states after gift opens */
  .gift.open + .surprise .surprise-image{ opacity:1; transform:translateY(0) scale(1); }
  .gift.open + .surprise .joker-card{ opacity:1; transform:translateX(-50%) translateY(0) scale(1); }

  @keyframes neonFlow{
    0%  { border-image-source: linear-gradient(90deg, #ff66a3, #ffd43b, #5eead4); }
    50% { border-image-source: linear-gradient(90deg, #5eead4, #60a5fa, #ff66a3); }
    100%{ border-image-source: linear-gradient(90deg, #ffd43b, #5eead4, #60a5fa); }
  }
  .joker-card .tech-title{
    font-family: 'Orbitron', system-ui, sans-serif;
    font-weight: 700; letter-spacing:.5px; font-size:1.05rem; margin-bottom:6px;
    background: linear-gradient(90deg, #ffe8a3, #ffd43b, #ff66a3);
    -webkit-background-clip: text; background-clip:text; color: transparent;
    text-shadow: 0 0 12px rgba(255,232,163,.6);
  }
  .joker-card .tech-msg{
    font-family: 'Space Mono', ui-monospace, SFMono-Regular, Menlo, monospace;
    font-size:.95rem; line-height:1.35; color:#e6f1ff; text-shadow:0 0 8px rgba(255,255,255,.15);
  }
  .treat-chip{
    display:inline-block; padding:2px 10px; margin:0 2px; border-radius:999px; font-weight:700; letter-spacing:.4px;
    background: linear-gradient(90deg, #22d3ee, #60a5fa); color:#0b1220;
    box-shadow: 0 0 14px rgba(96,165,250,.55), 0 4px 10px rgba(0,0,0,.35);
    transform: translateY(-1px); animation: chipPulse 1.6s ease-in-out infinite;
  }
  @keyframes chipPulse{ 0%,100%{ filter: drop-shadow(0 0 6px rgba(96,165,250,.6)); } 50%{ filter: drop-shadow(0 0 12px rgba(34,211,238,.9)); } }
  .tech-msg::after{
    content:""; display:inline-block; width:10px; height:1.05em; margin-left:4px; vertical-align:-2px; background:#e6f1ff; opacity:.85; animation: caretBlink 1s steps(1) infinite;
  }
  @keyframes caretBlink{ 50%{ opacity:0; } }
  .clown{ width:110px; height:110px; margin:0 auto 6px; display:block; }

  .inline-banner{ display:flex; align-items:center; justify-content:center; margin:8px auto 12px; }
  .inline-banner .hb-text{
    font-weight:800; font-size:clamp(1.4rem, 3.2vw + 1rem, 2.6rem); line-height:1.1; letter-spacing:2px;
    background: var(--text-grad); background-size:300% 300%;
    -webkit-background-clip: text; background-clip: text; color: transparent;
    text-shadow: 0 2px 0 rgba(0,0,0,.35);
    animation: hueflow 9s ease-in-out infinite alternate;
  }

  .controls .btn{ min-width: 48px; min-height: 44px; }
  .btn-lg{ padding:.8rem 1.1rem; font-size:1rem; border-radius:14px; }

  .help-btn{
    position:fixed; right: max(12px, env(safe-area-inset-right, 12px)); bottom: max(12px, calc(env(safe-area-inset-bottom, 0) + 12px)); z-index:90;
    border-radius:999px; padding:12px 16px; font-weight:700;
    box-shadow:0 10px 30px rgba(0,0,0,.35);
    touch-action:manipulation;
  }

  @media (max-width: 768px){
    .scene{ padding-top:6.5rem; padding-bottom:4.5rem; }
    .table-surface{ height:36px; border-radius:12px; }
    .door-button{ width:min(120px, 42vw); height:min(120px,42vw); }
    .door-label{ top:calc(50% + 84px); }
    .joker-card{ width:min(94vw, 560px); }
  }
  @media (max-width: 420px){
    .bunting{ height:64px; }
    .string-lights{ height:82px; top:2px; }
    .message-card{ margin:10px auto 16px; padding:12px 14px; border-radius:16px; }
    .clown{ width:88px; height:88px; }
  }

  @media (prefers-reduced-motion: reduce){
    *{ animation:none !important; transition:none !important; }
  }
</style>
</head>
<body>
  <!-- Audio -->
  <audio id="music" src="birthday.mp3" preload="auto"></audio>

  <!-- Doors -->
  <div class="doors" id="doorsLayer" aria-label="Closed doors">
    <div class="door left"><span class="handle" style="top:55%;"></span></div>
    <div class="door right"><span class="handle" style="top:45%;"></span></div>

    <button id="btnDoorKnob" class="door-button d-flex align-items-center justify-content-center btn btn-warning" aria-label="Press to enter">
      <span>Press to Enter</span>
    </button>

    <div class="door-label d-none d-sm-block">Back from office… press to open</div>
  </div>

  <div class="dark-overlay" aria-hidden="true"></div>

  <!-- Bunting -->
  <svg class="bunting d-none d-sm-block" viewBox="0 0 1200 120" preserveAspectRatio="none" aria-hidden="true">
    <defs>
      <linearGradient id="tri1" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#ff99c2"/><stop offset="100%" stop-color="#ff4d8d"/></linearGradient>
      <linearGradient id="tri2" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#9bd0ff"/><stop offset="100%" stop-color="#4dabf7"/></linearGradient>
      <linearGradient id="tri3" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#b9f0bf"/><stop offset="100%" stop-color="#51cf66"/></linearGradient>
      <linearGradient id="tri4" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#ffe8a3"/><stop offset="100%" stop-color="#f9c642"/></linearGradient>
    </defs>
    <path d="M0,10 Q300,60 600,10 T1200,10" stroke="#fff" stroke-width="3" fill="none" opacity=".35"/>
    <g>
      <polygon points="40,20 10,110 70,110" fill="url(#tri1)"/>
      <polygon points="120,18 90,110 150,110" fill="url(#tri2)"/>
      <polygon points="200,22 170,110 230,110" fill="url(#tri3)"/>
      <polygon points="280,17 250,110 310,110" fill="url(#tri4)"/>
      <polygon points="360,23 330,110 390,110" fill="url(#tri1)"/>
      <polygon points="440,19 410,110 470,110" fill="url(#tri2)"/>
      <polygon points="520,21 490,110 550,110" fill="url(#tri3)"/>
      <polygon points="600,18 570,110 630,110" fill="url(#tri4)"/>
      <polygon points="680,22 650,110 710,110" fill="url(#tri1)"/>
      <polygon points="760,20 730,110 790,110" fill="url(#tri2)"/>
      <polygon points="840,24 810,110 870,110" fill="url(#tri3)"/>
      <polygon points="920,19 890,110 950,110" fill="url(#tri4)"/>
      <polygon points="1000,21 970,110 1030,110" fill="url(#tri1)"/>
      <polygon points="1080,23 1050,110 1110,110" fill="url(#tri2)"/>
    </g>
  </svg>

  <!-- Lights string -->
  <svg class="string-lights d-none d-sm-block" viewBox="0 0 1200 120" preserveAspectRatio="none" aria-hidden="true">
    <path d="M0,20 C300,100 900,-20 1200,60" stroke="#fff" stroke-width="2" fill="none" opacity=".35"/>
    <g>
      <circle class="bulb" cx="80" cy="38" r="6" fill="#ffe8a3"/>
      <circle class="bulb" cx="160" cy="60" r="6" fill="#ffd3e6"/>
      <circle class="bulb" cx="240" cy="75" r="6" fill="#b3e3ff"/>
      <circle class="bulb" cx="320" cy="55" r="6" fill="#ffd3e6"/>
      <circle class="bulb" cx="400" cy="34" r="6" fill="#ffe8a3"/>
      <circle class="bulb" cx="480" cy="48" r="6" fill="#b3e3ff"/>
      <circle class="bulb" cx="560" cy="70" r="6" fill="#ffd3e6"/>
      <circle class="bulb" cx="640" cy="50" r="6" fill="#ffe8a3"/>
      <circle class="bulb" cx="720" cy="28" r="6" fill="#ffd3e6"/>
      <circle class="bulb" cx="800" cy="46" r="6" fill="#b3e3ff"/>
      <circle class="bulb" cx="880" cy="72" r="6" fill="#ffd3e6"/>
      <circle class="bulb" cx="960" cy="54" r="6" fill="#ffe8a3"/>
      <circle class="bulb" cx="1040" cy="36" r="6" fill="#b3e3ff"/>
      <circle class="bulb" cx="1120" cy="64" r="6" fill="#ffd3e6"/>
    </g>
  </svg>

  <!-- FX layers -->
  <div class="balloons" id="balloons" aria-hidden="true"></div>
  <div class="confetti" id="confetti" aria-hidden="true"></div>
  <div class="sparkles" id="sparkles" aria-hidden="true"></div>

  <!-- Main -->
  <main class="scene container-fluid">
    <div class="row justify-content-center w-100">
      <div class="col-12 col-sm-11 col-md-9 col-lg-7 mx-auto">
        <h1 class="neon" style="font-size:clamp(1.2rem, 2.4vw + .9rem, 2rem);">🤫 A Surprise Awaits!</h1>

        <div class="inline-banner">
          <div class="hb-text">🎉 Happy Birthday! 🎂</div>
        </div>

        <!-- Step 1 -->
        <div id="step-lights" class="mt-2">
          <p class="prompt mb-2">It’s dark inside. Turn on the lights to reveal the surprise.</p>
          <div class="d-grid gap-2 d-sm-flex justify-content-center controls">
            <button id="btnLightsOn" class="btn btn-success btn-lg px-4 w-100 w-sm-auto">Turn on Lights 💡</button>
          </div>
          <small class="d-block mt-2 text-white-50">Music will start when the lights come on.</small>
        </div>

        <!-- Cake -->
        <div class="cake-wrap hidden" id="cakeWrap" role="region" aria-label="Cake area">
          <svg class="cake-svg" viewBox="0 0 700 520" role="img" aria-label="Birthday cake with a candle">
            <defs>
              <linearGradient id="choc" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#c99376"/><stop offset="100%" stop-color="#8a5a3d"/></linearGradient>
              <radialGradient id="frost" cx="50%" cy="0%" r="100%"><stop offset="0%" stop-color="#fff7f0"/><stop offset="100%" stop-color="#ffdede"/></radialGradient>
              <linearGradient id="candleBody" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#ffffff"/><stop offset="100%" stop-color="#f0e6ff"/></linearGradient>
              <radialGradient id="flameGrad" cx="50%" cy="60%" r="60%"><stop offset="0%" stop-color="#fff"/><stop offset="45%" stop-color="#ffd27a"/><stop offset="100%" stop-color="#ff9800"/></radialGradient>
            </defs>
            <ellipse cx="350" cy="495" rx="230" ry="18" fill="#000" opacity="0.25"/>
            <g id="tiers">
              <g transform="translate(100,320)"><rect x="0" y="0" width="500" height="110" rx="18" fill="url(#choc)"/><path d="M0,30 C80,70 150,0 230,30 C310,60 380,10 500,28 L500,0 L0,0 Z" fill="url(#frost)"/></g>
              <g transform="translate(160,240)"><rect x="0" y="0" width="380" height="90" rx="16" fill="url(#choc)"/><path d="M0,26 C60,60 120,5 190,28 C260,50 320,12 380,24 L380,0 L0,0 Z" fill="url(#frost)"/></g>
              <g transform="translate(220,180)"><rect x="0" y="0" width="260" height="70" rx="14" fill="url(#choc)"/><path d="M0,22 C40,46 80,6 130,24 C180,40 220,10 260,20 L260,0 L0,0 Z" fill="url(#frost)"/></g>
            </g>
            <g id="candle" class="candle-hit" tabindex="0" role="button" aria-label="Candle" transform="translate(350,160)">
              <rect x="-8" y="-60" width="16" height="60" rx="6" fill="url(#candleBody)" stroke="#e5dbff"/>
              <rect x="-2" y="-70" width="4" height="12" rx="2" fill="#333"/>
              <ellipse id="flame" class="flame" cx="0" cy="-88" rx="9" ry="16" fill="url(#flameGrad)"/>
            </g>
          </svg>
          <div class="table-surface" aria-hidden="true"></div>

          <div id="step-candle" class="mt-2 hidden">
            <p class="prompt mb-2">Tap the candle or use the button to light it 🕯️</p>
            <div class="d-grid d-sm-inline-flex gap-2 justify-content-center">
              <button id="btnLightCandle" class="btn btn-primary btn-sm w-100 w-sm-auto">Light Candle 🔥</button>
            </div>
          </div>

          <div id="step-blow" class="hidden mt-3">
            <p class="prompt">Make a wish… then blow out the candle!</p>
            <div class="d-grid d-sm-inline-flex gap-2 justify-content-center">
              <button id="btnBlow" class="btn btn-outline-warning w-100 w-sm-auto">💨 Blow Candle</button>
            </div>
          </div>
        </div>

        <!-- Messages -->
        <div id="messages" class="mt-3 hidden">
          <div class="message-card"><p id="typeLine" class="mb-0"></p></div>
        </div>

        <!-- Gift -->
        <div id="giftStage" class="gift-stage hidden">
          <p id="giftHint" class="text-info fw-semibold mb-2" style="text-align:center; opacity:0.9;">
            💾 Access restricted. Solve IQ challenge to decrypt your gift! 🔐
          </p>

          <div class="gift" id="gift" role="button" aria-label="Gift (tap to open)">
            <div class="lid"></div>
            <div class="box">
              <div class="ribbon-v"></div>
              <div class="ribbon-h"></div>
            </div>
          </div>

          <div class="surprise" id="surprise">
            <div class="emoji-burst" id="emojiBurst"></div>
            <!-- Joker card -->
            <div class="joker-card" id="jokerCard">
              <!-- <svg class="clown" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <circle cx="64" cy="64" r="54" fill="#fff5f5"/>
                <circle cx="38" cy="54" r="10" fill="#ff6b6b"/>
                <circle cx="90" cy="54" r="10" fill="#4dabf7"/>
                <ellipse cx="64" cy="76" rx="26" ry="20" fill="#ffe8a3"/>
                <circle cx="64" cy="70" r="8" fill="#ff3b30"/>
                <path d="M42 86 Q64 102 86 86" stroke="#222" stroke-width="4" fill="none" stroke-linecap="round"/>
                <circle cx="48" cy="58" r="4" fill="#222"/>
                <circle cx="80" cy="58" r="4" fill="#222"/>
                <path d="M30 40 C40 28, 56 26, 64 34" stroke="#ff4d8d" stroke-width="6" fill="none" stroke-linecap="round"/>
                <path d="M98 40 C88 28, 72 26, 64 34" stroke="#51cf66" stroke-width="6" fill="none" stroke-linecap="round"/>
              </svg> -->
               <!-- Surprise image -->
              <img id="surpriseImage" class="surprise-image" src="banner.png" alt="Your surprise" loading="lazy"/>


              <div class="tech-title">Surprise 🤩</div>
              <div class="tech-msg" id="giftMessage">
                "Birthday status: 200 OK ✅ Unique delivery confirmed — auto-assigning you joy and assigning me a
                <span class='treat-chip'>TREAT</span>. Please approve! 😜" <br>--<strong>Khorshed Alom</strong>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-3"><button id="btnReplay" class="btn btn-outline-light btn-sm hidden w-100 w-sm-auto">↻ Replay</button></div>
      </div>
    </div>
  </main>

  <!-- HELP / NEXT -->
  <button id="helpBtn" class="btn btn-info help-btn">❓ What do I do next?</button>

  <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
      <div class="modal-content bg-dark text-white border-light">
        <div class="modal-header">
          <h5 class="modal-title" id="helpTitle">What do I do now?</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="helpCurrent" class="mb-2"></div>
          <div id="helpNext" class="fw-bold"></div>
        </div>
        <div class="modal-footer">
          <button id="helpGoBtn" type="button" class="btn btn-primary">Take me there</button>
          <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Got it</button>
        </div>
      </div>
    </div>
  </div>

  <!-- IQ Game Modal -->
  <div class="modal fade" id="iqModal" tabindex="-1" aria-labelledby="iqTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
      <div class="modal-content bg-dark text-white border-light">
        <div class="modal-header">
          <h5 class="modal-title" id="iqTitle">🤣 Funny IQ Challenge</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="iqIntro" class="mb-2">Answer 3 silly-smart riddles. Get <strong>2+</strong> right to unlock the gift!</div>
          <div id="iqQuestion" class="fs-6 fw-semibold"></div>
          <div id="iqChoices" class="mt-3"></div>
          <div id="iqProgress" class="mt-3 small text-muted"></div>
          <div id="iqFeedback" class="mt-2"></div>
        </div>
        <div class="modal-footer">
          <button id="iqNextBtn" type="button" class="btn btn-primary">Next</button>
          <button id="iqRetryBtn" type="button" class="btn btn-outline-warning d-none">Retry</button>
          <button id="iqCloseBtn" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ========= ELEMENTS ========= */
const body = document.body;
const music = document.getElementById('music');

const doorsLayer   = document.getElementById('doorsLayer');
const btnDoorKnob  = document.getElementById('btnDoorKnob');

const stepLights   = document.getElementById('step-lights');
const btnLightsOn  = document.getElementById('btnLightsOn');

const cakeWrap     = document.getElementById('cakeWrap');
const stepCandle   = document.getElementById('step-candle');
const btnLightCandle = document.getElementById('btnLightCandle');
const stepBlow     = document.getElementById('step-blow');
const btnBlow      = document.getElementById('btnBlow');

const flame        = document.getElementById('flame');

const balloonsLayer = document.getElementById('balloons');
const confettiLayer = document.getElementById('confetti');
const sparklesLayer = document.getElementById('sparkles');

const messages     = document.getElementById('messages');
const typeLine     = document.getElementById('typeLine');

const giftStage    = document.getElementById('giftStage');
const gift         = document.getElementById('gift');
const emojiBurst   = document.getElementById('emojiBurst');
const btnReplay    = document.getElementById('btnReplay');

/* ========= HELP MODAL ========= */
const helpBtn   = document.getElementById('helpBtn');
const helpModal = new bootstrap.Modal(document.getElementById('helpModal'));
const helpCurrent = document.getElementById('helpCurrent');
const helpNext    = document.getElementById('helpNext');
const helpGoBtn   = document.getElementById('helpGoBtn');

/* ========= IQ MODAL ========= */
const iqModal   = new bootstrap.Modal(document.getElementById('iqModal'));
const iqQEl     = document.getElementById('iqQuestion');
const iqChoices = document.getElementById('iqChoices');
const iqProg    = document.getElementById('iqProgress');
const iqFeed    = document.getElementById('iqFeedback');
const iqNextBtn = document.getElementById('iqNextBtn');
const iqRetryBtn= document.getElementById('iqRetryBtn');

/* ========= UTIL ========= */
const isTiny = () => window.innerWidth <= 360;
const isSmall = () => window.innerWidth <= 420;

function playMusicAuto(){
  music.loop = true; music.volume = 0.7;
  const p = music.play(); if (p && p.catch){ p.catch(()=>{}); }
}

function burstConfetti(n){
  const total = n ?? (isTiny() ? 80 : isSmall() ? 120 : 200);
  confettiLayer.innerHTML='';
  const colors=['#ff4d8d','#ffd43b','#4dabf7','#51cf66','#ffffff'];
  for(let i=0;i<total;i++){
    const s = document.createElement('span');
    s.style.left = Math.random()*100 + 'vw';
    s.style.top  = -(Math.random()*40) + 'vh';
    const w = 6 + Math.random()*8, h = 8 + Math.random()*12;
    s.style.width = w+'px'; s.style.height=h+'px';
    s.style.background = colors[i%colors.length];
    s.style.animation = `fall ${4 + Math.random()*3}s linear ${Math.random()*1.5}s forwards`;
    confettiLayer.appendChild(s);
  }
  setTimeout(()=> confettiLayer.innerHTML='', 8000);
}

function startSparkles(){
  const count = isTiny()? 18 : isSmall() ? 28 : 50;
  sparklesLayer.innerHTML='';
  for(let i=0;i<count;i++){
    const sp=document.createElement('span');
    sp.style.left = Math.random()*100+'vw';
    sp.style.bottom = Math.random()*30+'vh';
    sp.style.animationDelay = (Math.random()*2.6)+'s';
    sparklesLayer.appendChild(sp);
  }
}

function makeBalloonsSVG(){
  const count = isTiny()? 7 : isSmall()? 10 : 20;
  balloonsLayer.innerHTML='';
  const palettes=[
    {light:'#ffd2e1',mid:'#ff7aa6',dark:'#d84c7a'},
    {light:'#d6ebff',mid:'#74b3ff',dark:'#2a7bd9'},
    {light:'#d7ffd9',mid:'#6fe07d',dark:'#2f9e44'},
    {light:'#fff5cc',mid:'#ffd34d',dark:'#c99700'}
  ];
  for(let i=0;i<count;i++){
    const p=palettes[i%palettes.length],wrap=document.createElement('div');wrap.className='balloon-wrap';
    let leftVW=Math.random()*100; if(leftVW>38&&leftVW<62) leftVW=(Math.random()<.5)? (Math.random()*38):(62+Math.random()*38);
    wrap.style.left=leftVW+'vw'; wrap.style.setProperty('--drift',(Math.random()*60-30)+'px'); wrap.style.setProperty('--twist',(Math.random()*10-5)+'deg');
    wrap.style.animation=`floatUp ${7+Math.random()*6}s linear ${Math.random()*3}s infinite`;
    const gradId=`g${i}-${Date.now()}`;
    wrap.innerHTML=`
      <svg class="balloon-svg" viewBox="0 0 90 120" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <defs><radialGradient id="${gradId}" cx="50%" cy="35%" r="55%">
          <stop offset="0%" stop-color="${p.light}"/><stop offset="60%" stop-color="${p.mid}"/><stop offset="100%" stop-color="${p.dark}"/>
        </radialGradient></defs>
        <path d="M45 10c-20 0-35 14-35 33 0 18 11 29 22 38 3 2 1 7-1 10l4 6 20 0 4-6c-2-3-4-8-1-10 11-9 22-20 22-38 0-19-15-33-34-33z" fill="url(#${gradId})"/>
        <ellipse cx="35" cy="28" rx="7" ry="11" fill="#ffffff" opacity="0.5"/>
        <path d="M45 92 L45 106" stroke="#666" stroke-width="2"/>
      </svg>`;
    const stringEl=document.createElement('div'); stringEl.className='balloon-string'; wrap.appendChild(stringEl);
    balloonsLayer.appendChild(wrap);
  }
}

const TYPE_SPEED= isTiny()? 70 : 60;
const LINE_PAUSE= 2100;

function typeText(lines, cb){
  let i=0,j=0,current=''; typeLine.textContent='';
  function nextLine(){
    if(i>=lines.length){ cb&&cb(); return; }
    current=lines[i]; j=0; typeLine.textContent='';
    const iv=setInterval(()=>{
      typeLine.textContent=current.slice(0,++j);
      if(j>=current.length){ clearInterval(iv); setTimeout(()=>{ i++; nextLine(); }, LINE_PAUSE); }
    }, TYPE_SPEED);
  } nextLine();
}

function spawnEmojiBurst(){
  const emojis=['💖','✨','🎉','💝','⭐','🎈','🥳']; emojiBurst.innerHTML='';
  const total=isTiny()?8:isSmall()?12:16;
  for(let i=0;i<total;i++){
    const span=document.createElement('span'); span.textContent=emojis[i%emojis.length];
    span.style.setProperty('--dx',(Math.random()*140-70)+'px');
    span.style.setProperty('--dy',(-70-Math.random()*100)+'px');
    span.style.left=(Math.random()*60-30)+'px'; span.style.animationDelay=(Math.random()*0.12)+'s';
    emojiBurst.appendChild(span);
  }
}

/* ========= STATE MACHINE =========
   0: at door
   1: lights step visible
   2: candle lighting step visible
   3: blow step visible
   4: typing messages
   5: gift stage visible (locked by IQ)
   6: gift opened
===================================*/
let STAGE = 0;
let giftUnlocked = false;

function resetVisibility(){
  stepLights.classList.remove('hidden');
  cakeWrap.classList.add('hidden');
  stepCandle.classList.add('hidden');
  stepBlow.classList.add('hidden');
  messages.classList.add('hidden');
  giftStage.classList.add('hidden');
}
resetVisibility();

/* Doors -> Stage 1 */
btnDoorKnob.addEventListener('click', ()=>{
  if(STAGE !== 0) return;
  body.classList.add('open');
  btnDoorKnob.setAttribute('disabled','disabled');
  setTimeout(()=>{
    doorsLayer.style.display='none';
    STAGE = 1;
    window.scrollTo({top:0, behavior:'smooth'});
  }, 1150);
});

/* Lights On -> Stage 2 */
btnLightsOn.addEventListener('click', ()=>{
  if(STAGE !== 1) return;
  body.classList.add('lights-on');
  stepLights.classList.add('hidden');
  cakeWrap.classList.remove('hidden');
  stepCandle.classList.remove('hidden');
  playMusicAuto();
  makeBalloonsSVG(); startSparkles(); burstConfetti();
  STAGE = 2;
  cakeWrap.scrollIntoView({behavior:'smooth', block:'center'});
});

/* Light candle -> Stage 3 */
function lightCandle(){
  if(STAGE !== 2) return;
  flame.style.opacity='1'; flame.classList.add('flicker');
  stepCandle.classList.add('hidden');
  stepBlow.classList.remove('hidden');
  STAGE = 3;
}
const candleEl = document.getElementById('candle');
candleEl.addEventListener('click', lightCandle);
candleEl.addEventListener('keydown', (e)=>{ if((e.key==='Enter'||e.key===' ')){ e.preventDefault(); lightCandle(); }});
btnLightCandle.addEventListener('click', lightCandle);

/* Blow candle -> Stage 4 -> 5 */
function blowOut(){
  if(STAGE !== 3) return;
  flame.style.opacity='0'; flame.classList.remove('flicker');
  stepBlow.classList.add('hidden');
  messages.classList.remove('hidden');
  STAGE = 4;

  const lines = [
    '🎉 Happy Birthday!',
    'Sent from Khorshed Alom',
    'Count your life by smiles, not tears',
    'Count your age by friends, not years',
    'Beloved Respected — wish you joy!',
    'শুভ পয়দা দিবস — Happy Downloading Day!',
    'Lots Of love 💖'
  ];
  typeText(lines, ()=>{
    giftStage.classList.remove('hidden');
    burstConfetti(isSmall()?100:160);
    giftStage.scrollIntoView({behavior:'smooth', block:'center'});
    STAGE = 5;
  });
}
btnBlow.addEventListener('click', blowOut);
document.addEventListener('keydown', (e)=>{ if(STAGE===3 && (e.key===' '||e.key==='Enter')){ e.preventDefault(); blowOut(); }});

/* IQ Game */
const QUESTION_POOL = [
  { q:'Which has many keys but can’t open a single lock?', choices:['Keyboard','Treasure chest','Hotel','Car dealer'], correct:0 },
  { q:'I get wetter the more I dry. What am I?', choices:['Sponge','Raincoat','Towel','Hair'], correct:2 },
  { q:'What goes up but never comes down?', choices:['Age','Balloon','Elevator','Prices on Fridays'], correct:0 },
  { q:'You see me once in June, twice in November, and never in May. What am I?', choices:['Letter E','Letter N','Letter U','Calendar'], correct:0 },
  { q:'If a plane crashes on the border of Bangladesh and India, where do they bury the survivors?', choices:['Bangladesh','India','Half in each','Nowhere—they\'re survivors'], correct:3 },
  { q:'Which is heavier: 1 kg of iron or 1 kg of cotton?', choices:['Iron','Cotton','Same weight','Depends on humidity 😅'], correct:2 },
  { q:'What has a head and a tail but no body?', choices:['Comet','Coin','Lizard (on break)','Kite'], correct:1 },
  { q:'If you have it, you want to share it. If you share it, you don\'t have it. What is it?', choices:['Money','Secret','Wi-Fi password','Chocolate'], correct:1 },
  { q:'What can fill a room but takes up no space?', choices:['Light','Air','A good joke','Music'], correct:0 },
  { q:'I’m tall when I’m young, and short when I’m old. What am I?', choices:['Candle','Tree','Human','Pencil'], correct:0 }
];
function sample(arr, n){
  const a=[...arr];
  for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
  return a.slice(0,n);
}
let QUESTIONS=[], iqIndex=0, iqScore=0, picked=null;

function renderIQ(){
  const item=QUESTIONS[iqIndex];
  iqQEl.textContent=item.q; iqChoices.innerHTML=''; picked=null;
  item.choices.forEach((c,idx)=>{
    const b=document.createElement('button'); b.type='button';
    b.className='btn btn-outline-light w-100 text-start my-1'; b.textContent=c;
    b.onclick=()=>{ picked=idx; [...iqChoices.children].forEach(x=>x.classList.remove('active')); b.classList.add('active'); };
    iqChoices.appendChild(b);
  });
  iqProg.textContent=`Question ${iqIndex+1} of ${QUESTIONS.length} • Score: ${iqScore}`;
  iqFeed.textContent=''; iqNextBtn.textContent=iqIndex===QUESTIONS.length-1?'Finish':'Next';
  iqRetryBtn.classList.add('d-none');
}
function startIQ(){
  QUESTIONS = sample(QUESTION_POOL, 3);
  iqIndex=0; iqScore=0; picked=null; renderIQ(); iqModal.show();
}
iqNextBtn.addEventListener('click', ()=>{
  if(picked===null){ iqFeed.innerHTML='<span class="text-warning">Choose an answer to continue.</span>'; return; }
  if(picked===QUESTIONS[iqIndex].correct) iqScore++;
  if(++iqIndex<QUESTIONS.length){ renderIQ(); }
  else{
    const passed = iqScore>=2;
    iqQEl.textContent = passed? '✅ You passed the Funny IQ!':'❌ Close… but the clown says try again!';
    iqChoices.innerHTML=''; iqProg.textContent=`Score: ${iqScore}/${QUESTIONS.length}`;
    iqFeed.innerHTML = passed? '<span class="text-success">Gift unlocked! Close this to open 🎁</span>' : '<span class="text-warning">Get 2+ right. Tap Retry.</span>';
    iqNextBtn.classList.add('d-none'); iqRetryBtn.classList.toggle('d-none', passed);
    giftUnlocked = passed;
  }
});
iqRetryBtn.addEventListener('click', ()=>{ iqNextBtn.classList.remove('d-none'); startIQ(); });

/* Gift */
gift.addEventListener('click', ()=>{
  if(STAGE < 5) return;
  if(!giftUnlocked){
    startIQ();
    const modalEl=document.getElementById('iqModal');
    modalEl.addEventListener('hidden.bs.modal', function onHide(){
      modalEl.removeEventListener('hidden.bs.modal', onHide);
      if(giftUnlocked) openGift();
    });
  }else{
    if(!gift.classList.contains('open')) openGift();
    else { spawnEmojiBurst(); burstConfetti(isSmall()?100:160); }
  }
});
function openGift(){
  gift.classList.add('open');
  spawnEmojiBurst(); burstConfetti(isSmall()?140:200);
  btnReplay.classList.remove('hidden');
  STAGE = 6;
}

/* Replay */
btnReplay.addEventListener('click', ()=>{
  music.pause(); music.currentTime=0;
  body.className='';
  doorsLayer.style.display=''; btnDoorKnob.removeAttribute('disabled');
  flame.style.opacity='0'; flame.classList.remove('flicker');
  gift.classList.remove('open'); emojiBurst.innerHTML='';
  giftUnlocked=false; STAGE=0; resetVisibility();
  balloonsLayer.innerHTML=''; confettiLayer.innerHTML=''; sparklesLayer.innerHTML=''; typeLine.textContent='';
  window.scrollTo({top:0, behavior:'smooth'});
});

/* HELP / NEXT */
function getStepStatus(){
  switch(STAGE){
    case 0: return {current:'You are at the door.', next:'Press the big round button to enter.', target:btnDoorKnob};
    case 1: return {current:'Inside the room.',      next:'Tap “Turn on Lights”.',           target:btnLightsOn};
    case 2: return {current:'Room is lit ✨',         next:'Tap “Light Candle 🔥” or the candle.', target:btnLightCandle};
    case 3: return {current:'Candle is lit 🔥',      next:'Make a wish, then press “Blow Candle 💨”.', target:btnBlow};
    case 4: return {current:'Birthday messages typing…', next:'Wait a moment — the gift will appear.', target:typeLine};
    case 5: return {current:'Gift is ready 🎁',      next:'Tap the gift, pass Funny IQ to open.', target:gift};
    case 6: return {current:'All done! 🎉',          next:'Tap Replay to start again.',       target:btnReplay};
  }
}
helpBtn.addEventListener('click', ()=>{
  const s=getStepStatus();
  helpCurrent.textContent=`Current: ${s.current}`;
  helpNext.textContent=`Next: ${s.next}`;
  helpModal.show();
  helpGoBtn.onclick=()=>{ helpModal.hide(); s.target?.scrollIntoView?.({behavior:'smooth', block:'center'}); s.target?.focus?.(); };
});

/* Prevent overscroll bounce on iOS modals background */
document.addEventListener('touchmove', (e)=>{
  const m = document.querySelector('.modal.show');
  if(!m) return;
  if(!m.contains(e.target)) e.preventDefault();
}, {passive:false});
</script>

</body>
</html>
